services:
  anvil:
    image: ghcr.io/foundry-rs/foundry:nightly-156cb1396b7076c6f9cb56f3719f8c90f7f52064
    ports: [ "8545:8545" ]
    entrypoint: [ "anvil", "--host", "0.0.0.0" ]

  deploy-contracts:
    build:
      context: ./deploy-contracts
      dockerfile: ./deploy-contracts/Dockerfile
    environment:
      - ANVIL_RPC=http://anvil:8545

  alto:
    build: ../../
    ports: [ "4337:4337" ]
    command: --config alto-config.json
    volumes:
      - ./alto-config.json:/app/alto-config.json
    depends_on:
      deploy-contracts:
        condition: service_completed_successfully
